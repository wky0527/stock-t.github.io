<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>智能自动做T计算器</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        button { margin: 5px; padding: 6px 12px; }
        #result { white-space: pre-line; font-size: 16px; margin-top: 20px; }
    </style>
</head>
<body>
<h2>智能自动做T计算器（支持正向/反向/略高/补仓/自定义）</h2>

<label>持仓股数: <input id="holdShares" type="number" value="2300"></label><br><br>
<label>成本价(元): <input id="costPrice" type="number" step="0.001" value="18.137"></label><br><br>
<label>当前股价(元): <input id="currentPrice" type="number" step="0.001" value="15.640"></label><br><br>
<label>目标差价(元/股): <input id="targetDiff" type="number" step="0.01" value="0.5"></label><br><br>

<h3>操作模式：</h3>
<button onclick="calcForwardT()">正向做T</button>
<button onclick="calcReverseT()">反向做T</button>
<button onclick="calcReverseHigher()">略高买回模式</button>
<button onclick="calc补仓()">补仓计算</button>
<button onclick="calcCustom()">自定义模式</button>

<h3>结果：</h3>
<div id="result"></div>

<script>
    // 手续费率
    const feeRate = 0.00023;   // 万2.3
    const taxRate = 0.0005;    // 万5（仅卖出收）

    // 计算手续费
    function calcFee(amount, isSell){
        let fee = amount * feeRate;
        if(isSell) fee += amount * taxRate;
        return fee < 5 ? 5 : fee; // 最低5元
    }

    // 正向做T：先买后卖
    function calcForwardT(){
        let holdShares = +document.getElementById("holdShares").value;
        let costPrice = +document.getElementById("costPrice").value;
        let currentPrice = +document.getElementById("currentPrice").value;
        let diff = +document.getElementById("targetDiff").value;

        let buyPrice = currentPrice - diff/2;
        let sellPrice = buyPrice + diff;
        let buyShares = Math.floor(holdShares*0.2); // 默认买20%

        let buyCost = buyPrice*buyShares + calcFee(buyPrice*buyShares,false);
        let sellIncome = sellPrice*buyShares - calcFee(sellPrice*buyShares,true);
        let profit = sellIncome - buyCost;

        let newCost = (costPrice*holdShares - profit) / holdShares;

        document.getElementById("result").innerText =
            `【正向做T】\n买入股数: ${buyShares} 股 @${buyPrice.toFixed(2)} 元\n卖出股数: ${buyShares} 股 @${sellPrice.toFixed(2)} 元\n本次净收益: ${profit.toFixed(2)} 元\n新成本价: ${newCost.toFixed(3)} 元\n提示: 若股价到 ${sellPrice.toFixed(2)} 元即可完成正向T`;
    }

    // 反向做T：先卖后买
    function calcReverseT(){
        let holdShares = +document.getElementById("holdShares").value;
        let costPrice = +document.getElementById("costPrice").value;
        let currentPrice = +document.getElementById("currentPrice").value;
        let diff = +document.getElementById("targetDiff").value;

        let sellPrice = currentPrice + diff/2;
        let buyPrice = sellPrice - diff;
        let sellShares = Math.floor(holdShares*0.2); // 默认卖20%

        let sellIncome = sellPrice*sellShares - calcFee(sellPrice*sellShares,true);
        let buyCost = buyPrice*sellShares + calcFee(buyPrice*sellShares,false);
        let profit = sellIncome - buyCost;

        let newCost = (costPrice*holdShares - profit) / holdShares;

        document.getElementById("result").innerText =
            `【反向做T】\n卖出股数: ${sellShares} 股 @${sellPrice.toFixed(2)} 元\n买回股数: ${sellShares} 股 @${buyPrice.toFixed(2)} 元\n本次净收益: ${profit.toFixed(2)} 元\n新成本价: ${newCost.toFixed(3)} 元\n提示: 若股价回落至 ${buyPrice.toFixed(2)} 元即可完成反向T`;
    }

    // 略高买回模式
    function calcReverseHigher(){
        let holdShares = +document.getElementById("holdShares").value;
        let costPrice = +document.getElementById("costPrice").value;
        let currentPrice = +document.getElementById("currentPrice").value;
        let sellShares = Math.floor(holdShares*0.2);

        let sellPrice = currentPrice;
        let buyPrice = sellPrice * 1.01; // 略高 1%

        let sellIncome = sellPrice*sellShares - calcFee(sellPrice*sellShares,true);
        let buyCost = buyPrice*sellShares + calcFee(buyPrice*sellShares,false);
        let profit = sellIncome - buyCost;

        let newCost = (costPrice*holdShares - profit) / holdShares;

        document.getElementById("result").innerText =
            `【略高买回模式】\n卖出股数: ${sellShares} 股 @${sellPrice.toFixed(2)} 元\n买回股数: ${sellShares} 股 @${buyPrice.toFixed(2)} 元\n本次净收益: ${profit.toFixed(2)} 元\n新成本价: ${newCost.toFixed(3)} 元\n提示: 若股价上涨至 ${buyPrice.toFixed(2)} 元即可完成补回`;
    }

    // 补仓计算
    function calc补仓(){
        let holdShares = +document.getElementById("holdShares").value;
        let costPrice = +document.getElementById("costPrice").value;
        let currentPrice = +document.getElementById("currentPrice").value;

        let addShares = holdShares*0.2;
        let newCost = (costPrice*holdShares + currentPrice*addShares) / (holdShares+addShares);

        document.getElementById("result").innerText =
            `【补仓计算】\n补仓股数: ${addShares} 股 @${currentPrice.toFixed(2)} 元\n新成本价: ${newCost.toFixed(3)} 元\n提示: 若股价维持在 ${currentPrice.toFixed(2)} 元补仓，则成本降至 ${newCost.toFixed(3)} 元`;
    }

    // 自定义模式
    function calcCustom(){
        let holdShares = +document.getElementById("holdShares").value;
        let costPrice = +document.getElementById("costPrice").value;
        let currentPrice = +document.getElementById("currentPrice").value;

        let sellShares = prompt("请输入卖出股数", Math.floor(holdShares*0.1));
        let sellPrice = prompt("请输入卖出价格", currentPrice.toFixed(2));
        let buyPrice = prompt("请输入买入价格", (currentPrice-0.3).toFixed(2));

        sellShares = +sellShares;
        sellPrice = +sellPrice;
        buyPrice = +buyPrice;

        let sellIncome = sellPrice*sellShares - calcFee(sellPrice*sellShares,true);
        let buyCost = buyPrice*sellShares + calcFee(buyPrice*sellShares,false);
        let profit = sellIncome - buyCost;
        let newCost = (costPrice*holdShares - profit) / holdShares;

        document.getElementById("result").innerText =
            `【自定义做T】\n卖出股数: ${sellShares} 股 @${sellPrice.toFixed(2)} 元\n买回股数: ${sellShares} 股 @${buyPrice.toFixed(2)} 元\n本次净收益: ${profit.toFixed(2)} 元\n新成本价: ${newCost.toFixed(3)} 元\n提示: 若股价到 ${buyPrice.toFixed(2)} 元即可完成补回`;
    }
</script>
</body>
</html>
